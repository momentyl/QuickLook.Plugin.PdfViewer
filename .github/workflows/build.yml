name: Build QuickLook Plugin

on:
  push:
    branches: [ "master", "main" ] # 监听主分支的代码提交
  workflow_dispatch: # 允许你在 Actions 页面手动点击按钮触发构建

jobs:
  build:
    runs-on: windows-latest # QuickLook 是 Windows 软件，必须用 Windows 环境构建

    steps:
    # 1.以此步骤拉取你的代码
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. 配置 .NET 环境
    # 注意：请检查你项目 .csproj 文件中的 TargetFramework。
    # 如果是较老的项目可能需要 .NET Framework 4.x，如果是新的通常是 .NET 6/7/8
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x' # 这里写你项目对应的 .NET 版本，例如 6.0.x 或 8.0.x

    # 3. 还原依赖项
    - name: Restore dependencies
      run: dotnet restore

    # 4. 编译并发布 (Release模式)
    # -o publish_output 会将编译好的干净文件放入 publish_output 文件夹
    - name: Build and Publish
      run: dotnet publish -c Release -o publish_output

    # 5. 打包成 .qlplugin
    # 这里使用 PowerShell 将输出文件夹压缩，并将后缀命名为 .qlplugin
    - name: Pack into .qlplugin
      run: |
        cd publish_output
        Compress-Archive -Path * -DestinationPath ../PdfViewer.qlplugin

    # 6. 上传构建产物
    # 构建完成后，你可以在 GitHub Actions 页面下载这个文件
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: PdfViewer-Plugin
        path: PdfViewer.qlplugin
